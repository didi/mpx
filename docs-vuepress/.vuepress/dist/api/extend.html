<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>周边拓展 | Mpx框架</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <script type="text/javascript">(function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "jtvvy52wxy");</script>
    <meta name="description" content="Mpxjs 是滴滴开源的支持跨端开发、深度性能优化的增强型小程序开发框架。使用 Mpxjs 帮助你更好开发小程序，拥有类似 VueJS 的数据响应能力，在降低研发心智负担的同时比原生小程序性能更好，完全基于原生小程序语法保障了最少的坑，一次开发多端生效同时支持微信小程序、支付宝小程序、抖音小程序、百度小程序、Web H5。">
    
    <link rel="preload" href="/assets/css/0.styles.f22478ca.css" as="style"><link rel="preload" href="/assets/js/app.84c88b57.js" as="script"><link rel="preload" href="/assets/js/7.01e4e942.js" as="script"><link rel="preload" href="/assets/js/3.145e69cd.js" as="script"><link rel="preload" href="/assets/js/1.4f7abe8f.js" as="script"><link rel="preload" href="/assets/js/41.8351af86.js" as="script"><link rel="preload" href="/assets/js/30.04d1a7ea.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.f22478ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><div class="content-wrapper"><div class="container"><div class="theme-container"><header class="header" data-v-3ad594c3><!----> <div class="head-container" data-v-3ad594c3><a href="/" data-v-3ad594c3><div class="logo" data-v-3ad594c3>mpx</div></a> <div class="row" data-v-3ad594c3><div class="header__line" data-v-3ad594c3></div> <nav class="nav" data-v-3ad594c3><a href="/guide/basic/start.html" class="nav-link" data-v-3ad594c3>
          指南
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="/api/" class="nav-link" data-v-3ad594c3>
          API
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="/articles/" class="nav-link" data-v-3ad594c3>
          文章
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="https://github.com/didi/mpx/releases" target="_blank" class="nav-link" data-v-3ad594c3>
          更新记录
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="https://github.com/didi/mpx" target="_blank" class="nav-link" data-v-3ad594c3>
          GitHub
          <!----></a></nav> <div class="searchBox-wrapper" data-v-3ad594c3><div class="searchBox" data-v-3ad594c3><form id="search-form" role="search" class="algolia-search-wrapper search-box" data-v-3ad594c3><div id="docsearch-container"></div></form></div></div></div></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/basic/start.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/index.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/articles/index.html" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://github.com/didi/mpx/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/didi/mpx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/api/app-config.html" class="sidebar-link">全局配置</a></li><li><a href="/api/global-api.html" class="sidebar-link">全局 API</a></li><li><a href="/api/instance-api.html" class="sidebar-link">实例 API</a></li><li><a href="/api/store-api.html" class="sidebar-link">Store API</a></li><li><a href="/api/directives.html" class="sidebar-link">模板指令</a></li><li><a href="/api/compile.html" class="sidebar-link">编译构建</a></li><li><a href="/api/builtIn.html" class="sidebar-link">内建组件</a></li><li><a href="/api/reactivity-api.html" class="sidebar-link">响应式 API</a></li><li><a href="/api/composition-api.html" class="sidebar-link">组合式 API</a></li><li><a href="/api/optional-api.html" class="sidebar-link">选项式 API</a></li><li><a href="/api/extend.html" aria-current="page" class="active sidebar-link">周边拓展</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/extend.html#mpx-fetch" class="sidebar-link">mpx-fetch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/extend.html#fetch-config" class="sidebar-link">fetch(config)</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#canceltoken" class="sidebar-link">CancelToken</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#xfetch" class="sidebar-link">XFetch</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#interceptors" class="sidebar-link">interceptors</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#proxy" class="sidebar-link">proxy 代理</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#usefetch" class="sidebar-link">useFetch</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/extend.html#api-proxy" class="sidebar-link">api-proxy</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#webview-bridge" class="sidebar-link">webview-bridge</a></li><li class="sidebar-sub-header"><a href="/api/extend.html#size-report" class="sidebar-link">size-report</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/extend.html#插件配置项" class="sidebar-link">插件配置项</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/extend.html#i18n" class="sidebar-link">i18n</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/extend.html#usei18n" class="sidebar-link">useI18n</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="周边拓展"><a href="#周边拓展" class="header-anchor">#</a> 周边拓展</h1> <h2 id="mpx-fetch"><a href="#mpx-fetch" class="header-anchor">#</a> mpx-fetch</h2> <p>mpx-fetch提供了一个实例<strong>xfetch</strong> ，该实例包含以下api</p> <h3 id="fetch-config"><a href="#fetch-config" class="header-anchor">#</a> fetch(config)</h3> <blockquote><p>正常的promisify风格的请求方法</p></blockquote> <ul><li><p><code>{Object} config</code></p> <p>config 可指定以下属性：</p> <ul><li><p><strong>url</strong></p> <p><code>string</code></p> <p>设置请求url</p></li> <li><p><strong>method</strong></p> <p><code>string</code></p> <p>设置请求方式，默认为GET</p></li> <li><p><strong>data</strong></p> <p><code>object</code></p> <p>设置请求参数</p></li> <li><p><strong>params</strong></p> <p><code>object</code></p> <p>设置请求参数，参数会以 Query String 的形式进行传递</p></li> <li><p><strong>header</strong></p> <p><code>object</code></p> <p>设置请求的 header，header 中不能设置 Referer。
<code>content-type</code> 默认为 <code>application/json</code></p></li> <li><p><strong>timeout</strong></p> <p><code>number</code></p> <p>单位为毫秒。若不传，默认读取app.json文件中__networkTimeout属性。 对于超时的处理可在 catch 方法中进行</p></li> <li><p><strong>emulateJSON</strong></p> <p><code>boolean</code></p> <p>设置为 true 时，等价于 header = {'content-type': 'application/x-www-form-urlencoded'}</p></li> <li><p><strong>usePre</strong></p> <p><code>boolean</code></p> <p>预请求开关，若设置为 true，则两次请求间隔在有效期内且请求参数和请求方式对比一致的情况下，会返回上一次的请求结果</p></li> <li><p><strong>cacheInvalidationTime</strong></p> <p><code>number</code></p> <p>预请求缓存有效时长，单位 ms，默认为 5000ms。当两次请求时间间隔超过设置时长后再发起二次请求时，上一次的请求缓存会失效然后重新发起请求</p></li> <li><p><strong>ignorePreParamKeys</strong></p> <p><code>array</code> | <code>string</code></p> <p>在判断缓存请求是否可用对比前后两次请求参数时，默认对比的是 options 传入的所有参数（包括 params 和 data ）。但在具体业务场景下某些参数不一致时的缓存结果依旧可使用（比如参数中带有时间戳），所以提供 ignorePreParamKeys 来设置对比参数过程中可忽略的参数的 key，支持字符串数组和字符串（字符串传多个 key 时使用英文逗号分隔）类型。
配置后在进行参数对比时，不会对比在 ignorePreParamKeys 设置的参数。</p></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">import</span> mpxFetch <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
mpx<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mpxFetch<span class="token punctuation">)</span>
<span class="token comment">// 第一种访问形式</span>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://xxx.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">emulateJSON</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usePre</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheInvalidationTime</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ignorePreParamKeys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'timestamp'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

mpx<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 第二种访问形式</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>$xfetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://test.com'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="canceltoken"><a href="#canceltoken" class="header-anchor">#</a> CancelToken</h3> <p>命名导出，用于创建一个取消请求的凭证。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CancelToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
<span class="token keyword">const</span> cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://xxx.com'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">cancelToken</span><span class="token operator">:</span> cancelToken<span class="token punctuation">.</span>token
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cancelToken<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'手动取消请求'</span><span class="token punctuation">)</span> <span class="token comment">// 执行后请求中断，返回abort fail</span>
</code></pre></div><h3 id="xfetch"><a href="#xfetch" class="header-anchor">#</a> XFetch</h3> <p>命名导出，用于创建一个新的mpx-fetch实例进行独立使用</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">interface</span> <span class="token class-name">FetchOptions</span><span class="token punctuation">{</span>
    useQueue<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// 是否开启队列功能</span>
    proxy<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// 是否开启代理功能</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> XFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
<span class="token keyword">const</span> newFetch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XFetch</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// 生成新的mpx-fetch实例</span>
</code></pre></div><h3 id="interceptors"><a href="#interceptors" class="header-anchor">#</a> interceptors</h3> <blockquote><p>实例属性，用于添加拦截器，包含两个属性，request &amp; response</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token comment">// 也可以返回promise</span>
    <span class="token keyword">return</span> config
<span class="token punctuation">}</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token comment">// 也可以返回promise</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="proxy"><a href="#proxy" class="header-anchor">#</a> proxy 代理</h3> <h4 id="setproxy"><a href="#setproxy" class="header-anchor">#</a> setProxy</h4> <blockquote><p>配置代理项，可以传入一个数组或者一个对象，请求会按设置的规则进行代理</p></blockquote> <ul><li><p><strong>参数：</strong></p> <p><code>{Array | Object}</code></p> <ul><li><p><strong>test</strong></p> <p><code>object</code></p> <ul><li><p>url</p> <p><code>string</code></p> <p>全路径匹配，规则可以参考<a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="noopener noreferrer">path-to-regexp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也可参考下面的简单示例。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，则 protocol、host、port、path 规则不再生效。此项支持 path-to-regexp 匹配，protocol、host、port、path 为全等匹配。</p></div></li> <li><p>protocol</p> <p><code>string</code></p> <p>待匹配的协议头</p></li> <li><p>host</p> <p><code>string</code></p> <p>不包含端口的 host</p></li> <li><p>port</p> <p><code>string</code></p> <p>待匹配的端口</p></li> <li><p>path</p> <p><code>string</code></p> <p>待匹配的路径</p></li> <li><p>params</p> <p><code>object</code></p> <p>同时匹配请求中的 <code>params</code> 和 <code>query</code></p></li> <li><p>data</p> <p><code>object</code></p> <p>匹配请求中的 <code>data</code></p></li> <li><p>header</p> <p><code>object</code></p> <p>匹配请求中的 <code>header</code></p></li> <li><p>method</p> <p><code>Method | Method[]</code></p> <p>匹配请求方法，不区分大小写，可以传一个方法，也可以传一个方法数组</p></li> <li><p>custom</p> <p><code>function</code></p> <p>自定义匹配规则，参数会注入原始请求配置，结果需返回 <code>true</code> 或 <code>false</code></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，匹配结果以此项为准，以上规则均不再生效。</p></div></li></ul></li> <li><p><strong>proxy</strong></p> <p><code>object</code></p> <ul><li><p>url</p> <p><code>string</code></p> <p>代理的 url</p></li> <li><p>protocol</p> <p><code>string</code></p> <p>修改原请求的协议头</p></li> <li><p>host</p> <p><code>string</code></p> <p>代理的 host，不包含端口号</p></li> <li><p>port</p> <p><code>string</code></p> <p>修改端口号</p></li> <li><p>path</p> <p><code>string</code></p> <p>修改原请求路径</p></li> <li><p>params</p> <p><code>object</code></p> <p>合并原请求的 params</p></li> <li><p>data</p> <p><code>object</code></p> <p>合并原请求的 data</p></li> <li><p>header</p> <p><code>object</code></p> <p>合并原请求的 header</p></li> <li><p>method</p> <p><code>Method</code></p> <p>替换原请求的方法</p></li> <li><p>custom</p> <p><code>function</code></p> <p>自定义代理规则，会注入两个参数，第一个是上一个匹配规则处理后的请求配置，第二个是 match 的参数对象，结果需返回要修改的请求配置对象。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果设置了此项，最终代理配置将以此项为准，其他配置规则均不再生效。</p></div></li></ul></li> <li><p><strong>waterfall</strong></p> <p><code>boolean</code></p> <p>默认为 <code>false</code>，为 <code>false</code> 时，命中当前规则处理完就直接返回；为 <code>true</code> 时，命中当前匹配规则处理完成后将结果传递给下面命中匹配规则继续处理。</p></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">setProxy</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 此项匹配之后，会按下面 proxy 配置的修改请求配置</span>
		<span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'content-type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">test1</span><span class="token operator">:</span> <span class="token string">'abc'</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token string">'env test'</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">test2</span><span class="token operator">:</span> <span class="token string">'cba'</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 为 true 时会将此次修改后的请求配置继续传递给下面的规则处理</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token comment">// 可以分别单独匹配 protocol、host、port、path；代理规则同样</span>
        <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">'http:'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'mock.didi.com'</span><span class="token punctuation">,</span>
		<span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
		<span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/mock/test'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'test.didi.com'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8888</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义匹配规则</span>
        <span class="token function">custom</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// config 为原始的请求配置</span>
            <span class="token comment">// 自定义匹配逻辑</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>xxx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义代理配置</span>
        <span class="token function">custom</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// config 为上面匹配后修改过的请求配置</span>
            <span class="token comment">// params 为 match 后的参数对象</span>
            <span class="token comment">// 返回需要修改的请求配置对象</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token literal-property property">test3</span><span class="token operator">:</span> <span class="token string">'aaa'</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// : 可以匹配目标项，并将 match 结果返回到代理 custom 函数中</span>
        <span class="token comment">// :和?都属于保留符号，若不想做匹配时需用 '\\' 转义</span>
        <span class="token comment">// (.*)为全匹配</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">':protocol\\://mock.didi.com/mock/:id/oneapi/router/forum/api/v1/(.*)'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'post'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://127.0.0.1:8080/go/into/$id/api/v2/abcd'</span> <span class="token comment">// '$'项在代理生效后会替换匹配规则中的':'项</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// false 时不会继续匹配后面的规则</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="prependproxy"><a href="#prependproxy" class="header-anchor">#</a> prependProxy</h4> <blockquote><p>向前追加代理规则</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">prependProxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="appendproxy"><a href="#appendproxy" class="header-anchor">#</a> appendProxy</h4> <blockquote><p>向后追加代理规则</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">appendProxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">waterfall</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="getproxy"><a href="#getproxy" class="header-anchor">#</a> getProxy</h4> <blockquote><p>查看已有的代理配置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="clearproxy"><a href="#clearproxy" class="header-anchor">#</a> clearProxy</h4> <blockquote><p>解除所有的代理配置</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>mpx<span class="token punctuation">.</span>xfetch<span class="token punctuation">.</span><span class="token function">clearProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="usefetch"><a href="#usefetch" class="header-anchor">#</a> useFetch</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token function">useFetch</span><span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token operator">:</span> FetchOptions<span class="token punctuation">)</span><span class="token operator">:</span>xfetch
</code></pre></div><p>在组合式 API 中使用，用来获取 <code>@mpxjs/fetch</code> 插件的 xfetch 实例，等用于 <code>mpx.xfetch</code>。 关于 xfetch 实例的详细介绍，请点击<a href="/api/extend.html#mpx-fetch">查看</a></p> <p>此外该方法可选择传入 <code>options</code> 参数，若传入参数，则会创建一个新的 XFetch 实例返回，若不传入参数，则默认将全局 <code>xfetch</code> 实例返回。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.mpx</span>
<span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
<span class="token keyword">import</span> mpxFetch <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
mpx<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mpxFetch<span class="token punctuation">)</span>

<span class="token comment">// script-setup.mpx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/fetch'</span>
<span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://xxx.com'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">10</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">emulateJSON</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">usePre</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">cacheInvalidationTime</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">ignorePreParamKeys</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'timestamp'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>注意：</strong> options 参数同 <a href="/api/extend.html#XFetch">XFetch</a> 章节。</li></ul> <h2 id="api-proxy"><a href="#api-proxy" class="header-anchor">#</a> api-proxy</h2> <p>Mpx目前已经支持的API转换列表，供参考</p> <table><thead><tr><th>方法/平台</th> <th style="text-align:center;">wx</th> <th style="text-align:center;">ali</th> <th style="text-align:center;">web</th> <th style="text-align:center;">RN</th></tr></thead> <tbody><tr><td>getSystemInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getSystemInfoSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>nextTick</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>showToast</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>hideToast</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>showModal</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>showLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>hideLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>showActionSheet</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>showNavigationBarLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>hideNavigationBarLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>setNavigationBarTitle</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>setNavigationBarColor</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>request</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>downloadFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td></tr> <tr><td>uploadFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>setStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>setStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>removeStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>removeStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>getStorageInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getStorageInfoSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>clearStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>clearStorageSync</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>saveImageToPhotosAlbum</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>previewImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>compressImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>chooseImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>getLocation</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>saveFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>removeSavedFile</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>getSavedFileList</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>getSavedFileInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>addPhoneContact</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>setClipboardData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td></tr> <tr><td>getClipboardData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td></tr> <tr><td>setScreenBrightness</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>getScreenBrightness</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>makePhoneCall</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td></tr> <tr><td>stopAccelerometer</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>startAccelerometer</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>stopCompass</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>startCompass</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>stopGyroscope</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>startGyroscope</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>scanCode</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>login</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>checkSession</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>getUserInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>requestPayment</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>createCanvasContext</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>canvasToTempFilePath</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>canvasPutImageData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>canvasGetImageData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td></tr> <tr><td>createSelectorQuery</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td></tr> <tr><td>onWindowResize</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>offWindowResize</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>arrayBufferToBase64</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>base64ToArrayBuffer</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>connectSocket</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>getNetworkType</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>onNetworkStatusChange</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr> <tr><td>offNetworkStatusChange</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td></tr></tbody></table> <h2 id="webview-bridge"><a href="#webview-bridge" class="header-anchor">#</a> webview-bridge</h2> <p>Mpx 支持小程序跨平台后，多个平台的小程序里都提供了 webview 组件，webview 打开的 H5 页面可以通过小程序提供的 API 来与小程序通信以及调用一些小程序的能力，但是各家小程序对于 webview 提供的API是不一样的。</p> <p>比如微信的 webview 打开的 H5 页面里是通过调用 wx.miniProgram.navigateTo 来跳转到原生小程序页面的，而在支付宝是通过调用 my.navigateTo 来实现跳转的，那么我们开发 H5 时候为了让 H5 能适应各家小程序平台就需要写多份对应逻辑。</p> <p>为解决这个问题，Mpx 提供了抹平平台差异的bridge库：@mpxjs/webview-bridge。</p> <p><strong>安装：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>npm install @mpxjs<span class="token operator">/</span>webview<span class="token operator">-</span>bridge
</code></pre></div><p><strong>使用：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">'@mpxjs/webview-bridge'</span>
mpx<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mpx<span class="token punctuation">.</span>env <span class="token comment">// 输出：wx/qq/ali/baidu/tt</span>
mpx<span class="token punctuation">.</span><span class="token function">checkJSApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>cdn地址引用：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 开发环境版本，方便调试 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/D2JeLyT0_Y/2.2.43.webviewbridge.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 生产环境版本，压缩了体积 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/PRg145LZ-i/2.2.43.webviewbridge.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 同时支持 <span class="token constant">ES</span> Module 引入的 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/6MQOo-ocI4/2.2.43.webviewbridge.esm.browser.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// main.js</span>
<span class="token keyword">import</span> mpx <span class="token keyword">from</span> <span class="token string">&quot;https://dpubstatic.udache.com/static/dpubimg/6MQOo-ocI4/2.2.43.webviewbridge.esm.browser.min.js&quot;</span>

<span class="token comment">//ES Module 开发版本地址： https://dpubstatic.udache.com/static/dpubimg/cdhpNhmWmJ/2.2.43.webviewbridge.esm.browser.js</span>
</code></pre></div><p><strong>基础方法提供：</strong></p> <table><thead><tr><th>方法/平台</th> <th style="text-align:center;">wx</th> <th style="text-align:center;">qq</th> <th style="text-align:center;">ali</th> <th style="text-align:center;">baidu</th> <th style="text-align:right;">tt</th></tr></thead> <tbody><tr><td>navigateTo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>navigateBack</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>switchTab</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>reLaunch</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>redirectTo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>getEnv</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>postMessage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>getLoadError</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">✅</td></tr> <tr><td>onMessage</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr></tbody></table> <p><strong>扩展方法提供：</strong></p> <table><thead><tr><th>方法/平台</th> <th style="text-align:center;">wx</th> <th style="text-align:center;">qq</th> <th style="text-align:center;">ali</th> <th style="text-align:center;">baidu</th> <th style="text-align:right;">tt</th></tr></thead> <tbody><tr><td>checkJSApi</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>chooseImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>previewImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>uploadImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>downloadImage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>getLocalImgData</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>startRecord</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>stopRecord</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>onVoiceRecordEnd</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>playVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>pauseVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>stopVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>onVoicePlayEnd</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>uploadVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>downloadVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>translateVoice</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>getNetworkType</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>openLocation</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>getLocation</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:right;">❌</td></tr> <tr><td>stopSearchBeacons</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>onSearchBeacons</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>scanQRCode</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>chooseCard</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>addCard</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>openCard</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr> <tr><td>alert</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>showLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>hideLoading</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>setStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>getStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>removeStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>clearStorage</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>getStorageInfo</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>startShare</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>tradePay</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:center;"></td> <td style="text-align:right;"></td></tr> <tr><td>onMessage</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">❌</td> <td style="text-align:center;">✅</td> <td style="text-align:center;">❌</td> <td style="text-align:right;">❌</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>这个库仅提供给 H5 使用，请勿在小程序环境引入</p></div> <h2 id="size-report"><a href="#size-report" class="header-anchor">#</a> size-report</h2> <p>Mpx框架项目包体积可以进行分组、分包、页面、冗余Npm包等维度的分析和对比，详细<a href="/advance/size-report.html">请见</a></p> <h3 id="插件配置项"><a href="#插件配置项" class="header-anchor">#</a> 插件配置项</h3> <ul><li><p><strong>server</strong></p> <p><code>object</code></p> <p>本地可视化服务相关配置</p></li> <li><p><strong>filename</strong></p> <p><code>string</code></p> <p>构建生成的包体积详细输出文件地址</p></li> <li><p><strong>threshold</strong></p> <p><code>object</code></p> <p>配置项目总体积和分包体积阈值，包含两个字段，size 为项目总体积阈值，packages 为分包体积阈值</p> <div class="language-html extra-class"><pre class="language-html"><code>{
   size: '16MB', // 项目总包体积限额 16M
   packages: '2MB' // 项目每个分包体积限额 2M
}
</code></pre></div></li> <li><p><strong>groups</strong></p> <p><code>Array&lt;object&gt;</code></p> <p>配置体积计算分组，以输入分组为维度对体积进行分析，当没有该配置时结果中将不会包含分组体积信息</p> <ul><li><p>name</p> <p><code>string</code></p> <p>分组名称</p></li> <li><p>threshold</p> <p><code>string | object</code></p> <p>分组相关体积阈值，若不配置则该分组不校验体积阈值，同时也支持对分组中占各分包体积阈值</p> <div class="language-html extra-class"><pre class="language-html"><code>// 分组体积限额 500KB
threshold: '500KB'
// 或者如下方，分组体积限额500KB，分组占主包体积限额160KB
threshold: {
  size: '500KB',
  packages: {
    main: '160KB'
  }
}
</code></pre></div></li> <li><p>entryRules</p> <p><code>object</code></p> <p>配置分组 entry 匹配规则，小程序中所有的页面和组件都可被视为 entry</p> <ul><li>include: 包含符合条件的入口文件，默认为空数组，规则数组中支持函数、正则、字符串</li> <li>exclude: 剔除符合条件的入口文件，默认为空数组，规则数组中支持函数、正则、字符串</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>include: [/@someGroup\/some-npm-package/],
exclude: [/@someGroup\/some-two-pack/]
</code></pre></div></li> <li><p>noEntryRules</p> <p><code>object</code></p> <p>配置计算分组中纯 js 入口引入的体积（不包含组件和页面）</p> <ul><li>include: 包含符合条件的 js 文件，默认为空数组，规则数组中支持函数、正则、字符串</li> <li>exclude: 剔除符合条件的 js 文件，默认为空数组，规则数组中支持函数、正则、字符串</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>include: [/@someGroup\/some-npm-package/],
exclude: [/@someGroup\/some-two-pack/]
</code></pre></div></li></ul></li> <li><p><strong>reportPages</strong></p> <p><code>boolean</code></p> <p>是否收集页面维度体积详情，默认 false</p></li> <li><p><strong>reportAssets</strong></p> <p><code>boolean</code></p> <p>是否收集资源维度体积详情，默认 false</p></li> <li><p><strong>reportRedundance</strong></p> <p><code>boolean</code></p> <p>是否收集冗余资源，默认 false</p></li> <li><p><strong>showEntrysPackages</strong></p> <p><code>Array&lt;string&gt;</code></p> <p>展示某些分包资源的引用来源信息，例如 ['main'] 为查看主包资源的引用来源信息，默认为 []</p></li></ul> <p>配置使用示例：</p> <div class="language-html extra-class"><pre class="language-html"><code>{
  // 本地可视化服务相关配置
  server: {
    enable: true, // 是否启动本地服务，非必填，默认 true
    autoOpenBrowser: true, // 是否自动打开可视化平台页面，非必填，默认 true
    port: 0, // 本地服务端口，非必填，默认 0(随机端口)
    host: '127.0.0.1', // 本地服务host，非必填
  },
  // 体积报告生成后输出的文件地址名，路径相对为 dist/wx 或者 dist/ali
  filename: '../report.json',
  // 配置阈值，此处代表总包体积阈值为 16MB，分包体积阈值为 2MB，超出将会触发编译报错提醒，该报错不阻断构建
  threshold: {
    size: '16MB',
    packages: '2MB'
  },
  // 配置体积计算分组，以输入分组为维度对体积进行分析，当没有该配置时结果中将不会包含分组体积信息
  groups: [
    {
      // 分组名称
      name: 'vant',
      // 配置分组 entry 匹配规则，小程序中所有的页面和组件都可被视为 entry，如下所示的分组配置将计算项目中引入的 vant 组件带来的体积占用
      entryRules: {
        include: '@vant/weapp'
      }
    },
    {
      name: 'pageGroup',
      // 每个分组中可分别配置阈值，如果不配置则表示
      threshold: '500KB',
      entryRules: {
        include: ['src/pages/index', 'src/pages/user']
      }
    },
    {
      name: 'someSdk',
      entryRules: {
        include: ['@somegroup/someSdk/index', '@somegroup/someSdk2/index']
      },
      // 有的时候你可能希望计算纯 js 入口引入的体积（不包含组件和页面），这种情况下需要使用 noEntryRules
      noEntryRules: {
        include: 'src/lib/sdk.js'
      }
    }
  ],
  // 是否收集页面维度体积详情，默认 false
  reportPages: true,
  // 是否收集资源维度体积详情，默认 false
  reportAssets: true,
  // 是否收集冗余资源，默认 false
  reportRedundance: true,
  // 展示某些分包资源的引用来源信息，默认为 []
  showEntrysPackages: ['main']
}
</code></pre></div><h2 id="i18n"><a href="#i18n" class="header-anchor">#</a> i18n</h2> <h3 id="usei18n"><a href="#usei18n" class="header-anchor">#</a> useI18n</h3> <p>组合式 API 中使用，用来获取 i18n 实例。</p> <p><strong>参数选项</strong></p> <hr> <h4 id="locale"><a href="#locale" class="header-anchor">#</a> locale</h4> <p><code>Locale</code></p> <p>设置语言环境</p> <p><strong>注意：</strong> 只传 locale，不传 messages 属性时不起作用</p> <h4 id="fallbacklocale"><a href="#fallbacklocale" class="header-anchor">#</a> fallbackLocale</h4> <p><code>Locale</code></p> <p>预设的语言环境，找不到语言环境时进行回退。</p> <h4 id="messages"><a href="#messages" class="header-anchor">#</a> messages</h4> <p><code>LocaleMessages</code></p> <p>本地化的语言环境信息。</p> <p><strong>返回实例属性和方法</strong></p> <hr> <h4 id="locale-2"><a href="#locale-2" class="header-anchor">#</a> locale</h4> <p><code>WritableComputedRef&lt;Locale&gt;</code></p> <p>可响应性的 ref 对象，表示当前 i18n 实例所使用的 locale。</p> <p>修改 ref 值会对局部或者全局语言集的 locale 进行更改，并触发翻译方法重新执行。</p> <h4 id="fallbackroot"><a href="#fallbackroot" class="header-anchor">#</a> fallbackRoot</h4> <p><code>boolean</code></p> <p>本地化失败时是否回归到全局作用域。</p> <h4 id="getlocalemessage-locale"><a href="#getlocalemessage-locale" class="header-anchor">#</a> getLocaleMessage( locale )</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">getLocaleMessage</span> <span class="token punctuation">(</span>locale<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> LocaleMessageObject
</code></pre></div><p>获取语言环境的 <code>locale</code> 信息。</p> <h4 id="setlocalemessage-locale-message"><a href="#setlocalemessage-locale-message" class="header-anchor">#</a> setLocaleMessage( locale, message )</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">setLocaleMessage</span><span class="token punctuation">(</span>locale<span class="token operator">:</span> Locale<span class="token punctuation">,</span> messages<span class="token operator">:</span> LocaleMessageObject<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><p>设置语言环境的 <code>locale</code> 信息。</p> <h4 id="mergelocalemessage-locale-message"><a href="#mergelocalemessage-locale-message" class="header-anchor">#</a> mergeLocaleMessage( locale, message )</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">mergeLocaleMessage</span><span class="token punctuation">(</span>locale<span class="token operator">:</span> Locale<span class="token punctuation">,</span> messages<span class="token operator">:</span> LocaleMessageObject<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</code></pre></div><p>将语言环境信息 <code>locale</code> 合并到已注册的语言环境信息中。</p> <h4 id="messages-2"><a href="#messages-2" class="header-anchor">#</a> messages</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">readonly</span> messages<span class="token operator">:</span> ComputedRef<span class="token operator">&lt;</span><span class="token punctuation">{</span>
   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> Messages<span class="token punctuation">]</span><span class="token operator">:</span> Messages<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><strong>只读</strong></li></ul> <p>局部或者全局的语言环境信息。</p> <h4 id="isglobal"><a href="#isglobal" class="header-anchor">#</a> isGlobal</h4> <p><code>boolean</code></p> <p>是否是全局 i18n 实例。</p> <h4 id="t"><a href="#t" class="header-anchor">#</a> t</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">t</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> choice<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> values<span class="token operator">:</span> <span class="token builtin">Array</span> <span class="token operator">|</span> Object<span class="token punctuation">)</span><span class="token operator">:</span> TranslateResult
</code></pre></div><p>文案翻译函数</p> <p>根据传入的 key 以及当前 locale 环境获取对应文案，文案来源是全局作用域还是本地作用域取决于 <code>useI18n</code> 执行时是否传入对应的 <code>messages、locale</code> 等值。</p> <p><strong>choice 参数可选</strong> ，当传入 choice 时，t 函数的表现为使用复数进行翻译，和老版本中的 tc 函数表现一致。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{t('car', 1)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{t('car', 2)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{t('apple', 0)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{t('apple', 1)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{t('apple', 10, {count: 10})}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 语言环境信息如下：</span>
  <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">en</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">car</span><span class="token operator">:</span> <span class="token string">'car | cars'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">apple</span><span class="token operator">:</span> <span class="token string">'no apples | one apple | {count} apples'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>输入如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>car<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>cars<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>no apples<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>one apple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>10 apples<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>关于复数的更多信息可以点击<a href="https://kazupon.github.io/vue-i18n/zh/guide/pluralization.html#%E5%A4%8D%E6%95%B0" target="_blank" rel="noopener noreferrer">查看<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>values 参数可选</strong> ，如果需要对文案信息即逆行格式化处理，则需要传入 values。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  // 模版输出 hello world
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{t('message.hello', { msg: 'hello'})}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span>createComponent<span class="token punctuation">,</span> useI18n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@mpxjs/core&quot;</span>

  <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">en</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'{msg} world'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useI18n</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string-property property">'en-US'</span><span class="token operator">:</span> en
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>t<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="te"><a href="#te" class="header-anchor">#</a> te</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">te</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
</code></pre></div><p>检查 key 是否存在。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/optional-api.html" class="prev">
        选项式 API
      </a></span> <!----></p></div> </main></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.84c88b57.js" defer></script><script src="/assets/js/7.01e4e942.js" defer></script><script src="/assets/js/3.145e69cd.js" defer></script><script src="/assets/js/1.4f7abe8f.js" defer></script><script src="/assets/js/41.8351af86.js" defer></script><script src="/assets/js/30.04d1a7ea.js" defer></script>
  </body>
</html>
