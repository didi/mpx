<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>编译构建 | Mpx框架</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <script type="text/javascript">(function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "jtvvy52wxy");</script>
    <meta name="description" content="Mpxjs 是滴滴开源的支持跨端开发、深度性能优化的增强型小程序开发框架。使用 Mpxjs 帮助你更好开发小程序，拥有类似 VueJS 的数据响应能力，在降低研发心智负担的同时比原生小程序性能更好，完全基于原生小程序语法保障了最少的坑，一次开发多端生效同时支持微信小程序、支付宝小程序、抖音小程序、百度小程序、Web H5。">
    
    <link rel="preload" href="/assets/css/0.styles.f22478ca.css" as="style"><link rel="preload" href="/assets/js/app.84c88b57.js" as="script"><link rel="preload" href="/assets/js/7.01e4e942.js" as="script"><link rel="preload" href="/assets/js/3.145e69cd.js" as="script"><link rel="preload" href="/assets/js/1.4f7abe8f.js" as="script"><link rel="preload" href="/assets/js/38.7826170e.js" as="script"><link rel="preload" href="/assets/js/30.04d1a7ea.js" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.f22478ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><div class="content-wrapper"><div class="container"><div class="theme-container"><header class="header" data-v-3ad594c3><!----> <div class="head-container" data-v-3ad594c3><a href="/" data-v-3ad594c3><div class="logo" data-v-3ad594c3>mpx</div></a> <div class="row" data-v-3ad594c3><div class="header__line" data-v-3ad594c3></div> <nav class="nav" data-v-3ad594c3><a href="/guide/basic/start.html" class="nav-link" data-v-3ad594c3>
          指南
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="/api/" class="nav-link" data-v-3ad594c3>
          API
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="/articles/" class="nav-link" data-v-3ad594c3>
          文章
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="https://github.com/didi/mpx/releases" target="_blank" class="nav-link" data-v-3ad594c3>
          更新记录
          <!----></a></nav><nav class="nav" data-v-3ad594c3><a href="https://github.com/didi/mpx" target="_blank" class="nav-link" data-v-3ad594c3>
          GitHub
          <!----></a></nav> <div class="searchBox-wrapper" data-v-3ad594c3><div class="searchBox" data-v-3ad594c3><form id="search-form" role="search" class="algolia-search-wrapper search-box" data-v-3ad594c3><div id="docsearch-container"></div></form></div></div></div></div> <!----></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/basic/start.html" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/api/index.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/articles/index.html" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://github.com/didi/mpx/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/didi/mpx" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/api/app-config.html" class="sidebar-link">全局配置</a></li><li><a href="/api/global-api.html" class="sidebar-link">全局 API</a></li><li><a href="/api/instance-api.html" class="sidebar-link">实例 API</a></li><li><a href="/api/store-api.html" class="sidebar-link">Store API</a></li><li><a href="/api/directives.html" class="sidebar-link">模板指令</a></li><li><a href="/api/compile.html" aria-current="page" class="active sidebar-link">编译构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#类型定义" class="sidebar-link">类型定义</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#rules" class="sidebar-link">Rules</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin" class="sidebar-link">MpxWebpackPlugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#mode" class="sidebar-link">mode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#srcmode" class="sidebar-link">srcMode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#moderules" class="sidebar-link">modeRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#externalclasses" class="sidebar-link">externalClasses</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#resolvemode" class="sidebar-link">resolveMode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#projectroot" class="sidebar-link">projectRoot</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#writemode" class="sidebar-link">writeMode</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#autoscoperules" class="sidebar-link">autoScopeRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#forcedisableproxyctor" class="sidebar-link">forceDisableProxyCtor</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#transmpxrules" class="sidebar-link">transMpxRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#forceproxyeventrules" class="sidebar-link">forceProxyEventRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#defs" class="sidebar-link">defs</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#attributes" class="sidebar-link">attributes</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#externals" class="sidebar-link">externals</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mininpmpackage" class="sidebar-link">miniNpmPackage</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#forceusepagector" class="sidebar-link">forceUsePageCtor</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#transrpxrules" class="sidebar-link">transRpxRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#postcssinlineconfig" class="sidebar-link">postcssInlineConfig</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#decodehtmltext" class="sidebar-link">decodeHTMLText</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#nativeconfig" class="sidebar-link">nativeConfig</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#webconfig" class="sidebar-link">webConfig</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#i18n" class="sidebar-link">i18n</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#auditresource" class="sidebar-link">auditResource</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#subpackagemodulesrules" class="sidebar-link">subpackageModulesRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#generatebuildmap" class="sidebar-link">generateBuildMap</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#autovirtualhostrules" class="sidebar-link">autoVirtualHostRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#partialcompilerules" class="sidebar-link">partialCompileRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#optimizerenderrules" class="sidebar-link">optimizeRenderRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#asyncsubpackagerules" class="sidebar-link">asyncSubpackageRules</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#retryrequireasync" class="sidebar-link">retryRequireAsync</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#disablerequireasync" class="sidebar-link">disableRequireAsync</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#optimizesize" class="sidebar-link">optimizeSize</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-static-methods" class="sidebar-link">MpxWebpackPlugin static methods</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-loader" class="sidebar-link">MpxWebpackPlugin.loader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-pluginloader" class="sidebar-link">MpxWebpackPlugin.pluginLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-wxspreloader" class="sidebar-link">MpxWebpackPlugin.wxsPreLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-fileloader" class="sidebar-link">MpxWebpackPlugin.fileLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-urlloader" class="sidebar-link">MpxWebpackPlugin.urlLoader</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-getpageentry" class="sidebar-link">MpxWebpackPlugin.getPageEntry</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-getcomponententry" class="sidebar-link">MpxWebpackPlugin.getComponentEntry</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxwebpackplugin-getnativeentry" class="sidebar-link">MpxWebpackPlugin.getNativeEntry</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxunocssplugin" class="sidebar-link">MpxUnocssPlugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#unofile" class="sidebar-link">unoFile</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#mincount" class="sidebar-link">minCount</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#styleisolation" class="sidebar-link">styleIsolation</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#scan" class="sidebar-link">scan</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#escapemap" class="sidebar-link">escapeMap</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#root" class="sidebar-link">root</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#transformcss" class="sidebar-link">transformCSS</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#transformgroups" class="sidebar-link">transformGroups</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#config" class="sidebar-link">config</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#configfiles" class="sidebar-link">configFiles</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#commentconfig" class="sidebar-link">commentConfig</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#mpxunocssbase" class="sidebar-link">MpxUnocssBase</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#basefontsize" class="sidebar-link">baseFontSize</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#preflight" class="sidebar-link">preflight</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#dark" class="sidebar-link">dark</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#attributifypseudo" class="sidebar-link">attributifyPseudo</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#variableprefix" class="sidebar-link">variablePrefix</a></li></ul></li><li class="sidebar-sub-header"><a href="/api/compile.html#request-query" class="sidebar-link">Request query</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api/compile.html#resolve" class="sidebar-link">?resolve</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#root" class="sidebar-link">?root</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#fallback" class="sidebar-link">?fallback</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#uselocal" class="sidebar-link">?useLocal</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#isstyle" class="sidebar-link">?isStyle</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#ispage" class="sidebar-link">?isPage</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#iscomponent" class="sidebar-link">?isComponent</a></li><li class="sidebar-sub-header"><a href="/api/compile.html#async" class="sidebar-link">?async</a></li></ul></li></ul></li><li><a href="/api/builtIn.html" class="sidebar-link">内建组件</a></li><li><a href="/api/reactivity-api.html" class="sidebar-link">响应式 API</a></li><li><a href="/api/composition-api.html" class="sidebar-link">组合式 API</a></li><li><a href="/api/optional-api.html" class="sidebar-link">选项式 API</a></li><li><a href="/api/extend.html" class="sidebar-link">周边拓展</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="编译构建"><a href="#编译构建" class="header-anchor">#</a> 编译构建</h1> <p>对于使用 <code>@mpxjs/cli@3.x</code> 脚手架初始化的项目而言，编译构建相关的配置统一收敛至项目根目录下的 <code>vue.config.js</code> 进行配置。一个新项目初始化的 <code>vue.config.js</code> 如下图，相较于 <code>@mpxjs/cli@2.x</code> 版本，在新的初始化项目当中原有的编译构建配置都收敛至 cli 插件当中进行管理和维护，同时还对外暴露相关的接口或者 api 使得开发者能自定义修改 cli 插件当中默认的配置。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// mpx webpack plugin options</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// @mpxjs/unocss-plugin 相关的配置</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>对于使用 <code>@mpxjs/cli@2.x</code> 脚手架初始化的项目，编译构建配置涉及到 mpx 插件相关的配置主要是在 <code>config</code> 目录下 <code>mpxPlugin.conf.js</code>，涉及到 webpack 本身的配置主要是在 <code>build</code> 目录下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// config/mpxPlugin.conf.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// mpx webpack plugin options</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="类型定义"><a href="#类型定义" class="header-anchor">#</a> 类型定义</h2> <p>为了便于对编译配置的数据类型进行准确地描述，我们在这里对一些常用的配置类型进行定义</p> <h3 id="rules"><a href="#rules" class="header-anchor">#</a> Rules</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Condition</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>resourcePath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">|</span> RegExp

<span class="token keyword">interface</span> <span class="token class-name">Rules</span> <span class="token punctuation">{</span>
  include<span class="token operator">?</span><span class="token operator">:</span> Condition <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Condition<span class="token operator">&gt;</span>
  exclude<span class="token operator">?</span><span class="token operator">:</span> Condition <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Condition<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="mpxwebpackplugin"><a href="#mpxwebpackplugin" class="header-anchor">#</a> MpxWebpackPlugin</h2> <p>Mpx 编译构建跨平台小程序和 web 的 webpack 主插件，安装示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @mpxjs/webpack-plugin
<span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @mpxjs/webpack-plugin
<span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> @mpxjs/webpack-plugin
</code></pre></div><p>使用示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// mpx webpack plugin options</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>MpxWebpackPlugin支持传入以下配置：</p> <h3 id="mode"><a href="#mode" class="header-anchor">#</a> mode</h3> <p><code>'wx' | 'ali' | 'swan' | 'qq' | 'tt' | 'jd' | 'dd' | 'qa' | 'web' = 'wx'</code></p> <p>mode 为 Mpx 编译的目标平台， 目前支持的有微信小程序(wx)\支付宝小程序(ali)\百度小程序(swan)\头条小程序(tt)\QQ 小程序(qq)\京东小程序(jd)\滴滴小程序(dd)\快应用(qa)\H5 页面(web)。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 @mpxjs/cli@3.x 版本当中，通过在 <code>npm script</code> 当中定义 <code>targets</code> 来设置目标平台</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 项目 package.json</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;build:cross&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mpx-cli-service build --targets=wx,ali&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="srcmode"><a href="#srcmode" class="header-anchor">#</a> srcMode</h3> <p><code>'wx' | 'ali' | 'swan' | 'qq' | 'tt' | 'jd' | 'dd' | 'qa' = 'wx'</code></p> <p>默认和 <a href="#mode">mode</a> 一致。，当 srcMode 和 mode 不一致时，会读取相应的配置对项目进行编译和运行时的转换。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">srcMode</span><span class="token operator">:</span> <span class="token string">'wx'</span> <span class="token comment">// 根据项目初始化所选平台来设定</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>暂时只支持微信为源 mode 做跨平台，为其他时，mode 必须和 srcMode 保持一致。</p></div> <h3 id="moderules"><a href="#moderules" class="header-anchor">#</a> modeRules</h3> <p><code>{ [key: string]: Rules }</code></p> <p>批量指定文件mode，用于条件编译场景下使用某些单小程序平台的库时批量标记这些文件的mode为对应平台，而不再走转换规则。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">modeRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">ali</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/vant-aliapp'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="externalclasses"><a href="#externalclasses" class="header-anchor">#</a> externalClasses</h3> <p><code>Array&lt;string&gt;</code></p> <p>定义若干个外部样式类，这些将会覆盖元素原有的样式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">externalClasses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'custom-class'</span><span class="token punctuation">,</span> <span class="token string">'i-class'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>抹平支付宝和微信之间的差异，当使用了微信 <strong>externalClasses</strong> 语法时，跨端输出需要在 @mpxjs/webpack-plugin 的配置中添加此配置来辅助框架进行转换。</p></div> <h3 id="resolvemode"><a href="#resolvemode" class="header-anchor">#</a> resolveMode</h3> <p><code>'webpack' | 'native' = 'webpack'</code></p> <p>指定resolveMode，默认webpack，更便于引入npm包中的页面/组件等资源。若想编写时和原生保持一致或兼容已有原生项目，可设为native，此时需要提供<a href="#projectroot">projectRoot</a>以指定项目根目录，且使用npm资源时需在前面加<code>~</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">resolveMode</span><span class="token operator">:</span> <span class="token string">'webpack'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="projectroot"><a href="#projectroot" class="header-anchor">#</a> projectRoot</h3> <p><code>string</code></p> <p>当resolveMode为native时需通过该字段指定项目根目录。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token literal-property property">resolveMode</span><span class="token operator">:</span> <span class="token string">'native'</span><span class="token punctuation">,</span>
         <span class="token literal-property property">projectRoot</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="writemode"><a href="#writemode" class="header-anchor">#</a> writeMode</h3> <p><code>'full' | 'change' = 'change'</code></p> <p>webpack 的输出默认是全量输出，而小程序开发者工具不关心文件是否真正发生了变化。设置为 change 时，Mpx 在 watch 模式下将内部 diff 一次，只会对内容发生变化的文件进行写入，以提升小程序开发者工具编译性能。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token literal-property property">writeMode</span><span class="token operator">:</span> <span class="token string">'change'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="autoscoperules"><a href="#autoscoperules" class="header-anchor">#</a> autoScopeRules</h3> <p><a href="#rules"><code>Rules</code></a></p> <p>是否需要对样式加 scope ，目前只有支付宝小程序平台没有样式隔离，因此该部分内容也只对支付宝小程序平台生效。提供 include 和 exclude 以精确控制对哪些文件进行样式隔离，哪些不隔离，和webpack的rules规则相同。也可以通过在 style 代码块上声明 scoped 进行。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token literal-property property">autoScopeRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
           <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
           <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../node_modules/vant-aliapp'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token comment">// 比如一些组件库本来就是为支付宝小程序编写的，应该已经考虑过样式隔离，就不需要再添加</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="forcedisableproxyctor"><a href="#forcedisableproxyctor" class="header-anchor">#</a> forceDisableProxyCtor</h3> <p><code>boolean = false</code></p> <p>用于控制在跨平台输出时对实例构造函数（<code>App</code> | <code>Page</code> | <code>Component</code> | <code>Behavior</code>）进行代理替换以抹平平台差异。当配置 <code>forceDisableProxyCtor</code> 为 true 时，会强行取消平台差异抹平逻辑，开发时需针对输出到不同平台进行条件判断。</p> <h3 id="transmpxrules"><a href="#transmpxrules" class="header-anchor">#</a> transMpxRules</h3> <p><a href="#rules"><code>Rules</code></a></p> <p>是否转换 wx / my 等全局对象为 Mpx 对象，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transMpxRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">include</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@mpxjs'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="forceproxyeventrules"><a href="#forceproxyeventrules" class="header-anchor">#</a> forceProxyEventRules</h3> <p><a href="#rules"><code>Rules</code></a></p> <p>强制代理规则内配置的事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">forceProxyEventRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'bindtap'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="defs"><a href="#defs" class="header-anchor">#</a> defs</h3> <p><code>object</code></p> <p>给模板、js、json、style中定义一些全局常量。一般用于区分平台/环境。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">defs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">__env__</span><span class="token operator">:</span> <span class="token string">'mini'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在模板中使用：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>{{__env__}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在js中使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> env <span class="token operator">=</span> __env__<span class="token punctuation">;</span>
</code></pre></div><p>在style中使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* @mpx-if (__env__ === 'mini') */</span>
<span class="token punctuation">.</span>color <span class="token punctuation">{</span>
  <span class="token literal-property property">background</span><span class="token operator">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* @mpx-endif */</span>
</code></pre></div><p>在json中使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script name<span class="token operator">=</span><span class="token string">'json'</span><span class="token operator">&gt;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;component&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;a&quot;</span><span class="token operator">:</span> __env__
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><blockquote><p>注意：这里定义之后使用的时候是按照全局变量来使用，而非按照<code>process.env.KEY</code>这样的形式</p></blockquote> <h3 id="attributes"><a href="#attributes" class="header-anchor">#</a> attributes</h3> <p><code>Array&lt;string&gt; = ['image:src', 'audio:src', 'video:src', 'cover-image:src', 'import:src', 'include:src']</code></p> <p><code>Mpx</code> 提供了可以给自定义标签设置资源的功能，配置该属性后，即可在目标标签中使用 <code>:src</code> 加载相应资源文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">attributes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'customTag:src'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>customTag</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>https://www....../avator.png'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>customTag</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>该属性可通过 <code>MpxWebpackPlugin</code> 配置，也可以通过配置 <code>WxmlLoader</code>，后者优先级高。</p></div> <h3 id="externals"><a href="#externals" class="header-anchor">#</a> externals</h3> <p><code>Array&lt;string&gt;</code></p> <p>目前仅支持微信小程序 weui 组件库通过 useExtendedLib 扩展库的方式引入，这种方式引入的组件将不会计入代码包大小。配置 externals 选项，Mpx 将不会解析 weui 组件的路径并打包。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'weui'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// app.mpx json部分</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;useExtendedLib&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;weui&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 在 page 中使用 weui 组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{__mpx_mode__ === 'wx'}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mp-icon</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>play<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>black<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{25}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>showDialog<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mp-icon</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mp-dialog</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{dialogShow}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindbuttontap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tapDialogButton<span class="token punctuation">&quot;</span></span> <span class="token attr-name">buttons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{buttons}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>test content<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mp-dialog</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span><span class="token punctuation">{</span> createPage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>

  <span class="token function">createPage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">dialogShow</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">showOneButtonDialog</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'取消'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'确定'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">tapDialogButton</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialogShow <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showOneButtonDialog <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">showDialog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dialogShow <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> wxComponents <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;mp-icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;weui-miniprogram/icon/icon&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;mp-dialog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;weui-miniprogram/dialog/dialog&quot;</span>
  <span class="token punctuation">}</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;usingComponents&quot;</span><span class="token operator">:</span> __mpx_mode__ <span class="token operator">===</span> <span class="token string">'wx'</span>
      <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> wxComponents<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>参考</strong>：<a href="https://developers.weixin.qq.com/miniprogram/dev/extended/weui/quickstart.html" target="_blank">weui组件库</a></p> <h3 id="mininpmpackage"><a href="#mininpmpackage" class="header-anchor">#</a> miniNpmPackage</h3> <p><code>Array&lt;string&gt;</code></p> <p>微信小程序官方提供了<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html" target="_blank" rel="noopener noreferrer">发布小程序 npm 包的约束<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
部分小程序npm包，如<a href="https://vant-contrib.gitee.io/vant-weapp/#/quickstart" target="_blank" rel="noopener noreferrer">vant组件库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>官方文档使用说明，引用资源并不会包含miniprogram所指定的目录
如 &quot;@vant/weapp/button/index&quot;，导致 <code>Mpx</code> 解析路径失败。
<code>Mpx</code>为解决这个问题，提供miniNpmPackage字段供用户配置需要解析的小程序npm包。miniNpmPackage对应的数组值为npm包对应的package.json中的name字段。
<code>Mpx</code>解析规则如下:</p> <ol><li>如package.json中有miniprogram字段，则会默认拼接miniprogram对应的值到资源路径中</li> <li>如package.json中无miniprogram字段，但配置了miniNpmPackage，则默认会拼接miniprogram_dist目录</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">miniNpmPackage</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@vant/weapp'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="forceusepagector"><a href="#forceusepagector" class="header-anchor">#</a> forceUsePageCtor</h3> <p><code>Boolean = false</code></p> <p>为了获取更丰富的生命周期来进行更加完善的增强处理，在非支付宝小程序环境下，<code>Mpx</code> 默认会使用 <code>Conponent</code> 构造器来创建页面。将该值设置为 <code>true</code> 时，会强制使用 <code>Page</code> 构造器创建页面。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">forceUsePageCtor</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="transrpxrules"><a href="#transrpxrules" class="header-anchor">#</a> transRpxRules</h3> <p><code>Array&lt;object&gt; | object</code></p> <ul><li><code>option.mode</code> 可选值有 none/only/all，分别是不启用/只对注释内容启用/只对非注释内容启用</li> <li><code>option.designWidth</code> 设计稿宽度，默认值就是750，可根据需要修改</li> <li><code>option.include</code> 同webpack的include规则</li> <li><code>option.exclude</code> 同webpack的exclude规则</li> <li><code>option.comment</code> rpx注释，建议使用 'use px'/'use rpx'，当 mode 为 all 时默认值为 use px，mode 为 only 时默认值为 'use rpx'</li></ul> <p>为了处理某些IDE中不支持<code>rpx</code>单位的问题，Mpx 提供了一个将 px 转换为 rpx 的功能。支持通过注释控制行级、块级的是否转换，支持局部使用，支持不同依赖分别使用不用的转换规则等灵活的能力。<code>transRpxRules</code>可以是一个对象，也可以是多个这种对象组成的数组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'only'</span><span class="token punctuation">,</span> <span class="token comment">// 只对注释为'use rpx'的块儿启用转换rpx</span>
            <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use rpx'</span><span class="token punctuation">,</span> <span class="token comment">// mode为'only'时，默认值为'use rpx'</span>
            <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">exclude</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'lib'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span> <span class="token comment">// 所有样式都启用转换rpx，除了注释为'use px'的样式不转换</span>
            <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use px'</span><span class="token punctuation">,</span> <span class="token comment">// mode为'all'时，默认值为'use px'</span>
            <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/@didi/mpx-sec-guard'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="应用场景及相应配置"><a href="#应用场景及相应配置" class="header-anchor">#</a> 应用场景及相应配置</h4> <p>接下来我们来看下一些应用场景及如何配置。如果是用脚手架生成的项目，在<code>mpx.plugin.conf.js</code>里找到<code>transRpxRules</code>，应该已经有预设的<code>transRpxRules</code>选项，按例修改即可。</p> <p>三种场景分别是 <a href="#%E5%9C%BA%E6%99%AF%E4%B8%80">普通使用</a> ， <a href="#%E5%9C%BA%E6%99%AF%E4%BA%8C">只对某些特殊样式转换</a> ， <a href="#%E5%9C%BA%E6%99%AF%E4%B8%89">不同路径分别配置规则</a></p> <h4 id="场景一"><a href="#场景一" class="header-anchor">#</a> 场景一</h4> <p>设计师给的稿是2倍图，分辨率750px。或者更高倍图。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span> <span class="token comment">// 如果是其他倍，修改此值为设计稿的宽度即可</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="场景二"><a href="#场景二" class="header-anchor">#</a> 场景二</h4> <p>大部分样式都用px下，某些元素期望用rpx。或者反过来。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'only'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use rpx'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span> <span class="token comment">// 设计稿宽度</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>mpx的rpx注释能帮助你仅为部分类或者部分样式启用rpx转换，细节请看下方附录。</p> <h4 id="场景三"><a href="#场景三" class="header-anchor">#</a> 场景三</h4> <p>使用了第三方组件，它的设计宽度和主项目不一致，期望能设置不同的转换规则</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transRpxRules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'only'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
            <span class="token literal-property property">comment</span><span class="token operator">:</span> <span class="token string">'use rpx'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">designWidth</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token comment">// 对iview单独使用一个不同的designWidth</span>
            <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules/iview-weapp'</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>注意事项：转换规则是不可以对一个文件做多次转换的，会出错，所以一旦被一个规则命中后就不会再次命中另一个规则，include 和 exclude 的编写需要注意先后顺序，就比如上面这个配置，如果第一个规则 include 的是 '/' 即整个项目，iview-weapp 里的样式就无法命中第二条规则了。</p></blockquote> <h4 id="transrpxrules附录"><a href="#transrpxrules附录" class="header-anchor">#</a> transRpxRules附录</h4> <ul><li><strong>designWidth</strong></li></ul> <p>设计稿宽度，单位为<code>px</code>。默认值为<code>750px</code>。</p> <p><code>mpx</code>会基于小程序标准的屏幕宽度<code>baseWidth 750rpx</code>，与<code>option.designWidth</code>计算出一个转换比例<code>transRatio</code>。</p> <p>转换比例的计算方式为<code>transRatio = (baseWidth / designWidth)</code>，精度为小数点后2位四舍五入。</p> <p>所有生效的<code>rpx注释样式</code>中的px会乘上<code>transRatio</code>得出最终的 rpx 值。</p> <p>例如：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 转换前：designWidth = 1280 */</span>
<span class="token selector">.btn</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 转换后: transRatio = 0.59 */</span>
<span class="token selector">.btn</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 118rpx<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 59rpx<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>comment: rpx 注释样式</strong></li></ul> <p>根据<code>rpx注释</code>的位置，<code>mpx</code>会将<code>一段css规则</code>或者<code>一条css声明</code>视为<code>rpx注释样式</code>。</p> <p>开发者可以声明一段 rpx 注释样式，提示编译器是否转换这段 css 中的 px。</p> <p>例如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token comment">/* use rpx */</span>
  <span class="token selector">.not-translate-a</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.not-translate-b</span> <span class="token punctuation">{</span>
    <span class="token comment">/* use rpx */</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.translate-a</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.translate-b</span> <span class="token punctuation">{</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>第一个注释位于一个<code>选择器</code>前，是一个<code>css规则注释</code>，整个规则都会被视为<code>rpx注释样式</code></p></blockquote> <blockquote><p>第二个注释位于一个<code>css声明</code>前，是一个<code>css声明注释</code>，只有<code>font-size: 100px</code>会被视为<code>rpx注释样式</code></p></blockquote> <blockquote><p><code>transRpx = only</code>模式下，只有两部分<code>rpx注释样式</code>会转rpx。</p></blockquote> <h3 id="postcssinlineconfig"><a href="#postcssinlineconfig" class="header-anchor">#</a> postcssInlineConfig</h3> <p><code>{options? : PostcssOptions, plugins? : PostcssPlugin[], mpxPrePlugins? : PostcssPlugin[], ignoreConfigFile : Boolean}</code></p> <p>使用类似于 postcss.config.js 的语法书写 postcss 的配置文件。用于定义 Mpx 对于组件/页面样式进行 postcss 处理时的配置， ignoreConfigFile 传递为 true 时会忽略项目中的 postcss 配置文件 。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">postcssInlineConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// require('postcss-import'),</span>
            <span class="token comment">// require('postcss-preset-env'),</span>
            <span class="token comment">// require('cssnano'),</span>
            <span class="token comment">// require('autoprefixer')</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注意</strong>：默认添加的 postcss 插件均会在<code>mpx的内置插件</code>（例如如rpx插件等）之后处理。如需使配置的插件优先于内置插件，可以在 <code>postcssInlineConfig</code> 中添加 <code>mpxPrePlugins</code> 配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">postcssInlineConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-import'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">mpxPrePlugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span>
          <span class="token punctuation">]</span>
          <span class="token comment">// 以下写法同理</span>
          <span class="token comment">// mpxPrePlugins: {</span>
          <span class="token comment">//   'cssnano': {},</span>
          <span class="token comment">//   'autoprefixer': {}</span>
          <span class="token comment">// }</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>postcss.config.js</code> 中配置同理：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-import'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mpxPrePlugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><p>在上面这个例子当中，postcss 插件处理的最终顺序为：<code>cssnano</code> -&gt; <code>autoprefixer</code> -&gt; <code>mpx内置插件</code> -&gt; <code>postcss-import</code> -&gt; <code>postcss-preset-env</code></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意：在 <code>mpxPrePlugins</code> 中配置的 postcss 插件如果不通过 mpx 进行处理，那么将不会生效。</p></div> <h3 id="decodehtmltext"><a href="#decodehtmltext" class="header-anchor">#</a> decodeHTMLText</h3> <p><code>boolean = false</code></p> <p>设置为 true 时在模板编译时对模板中的 text 内容进行 decode</p> <h3 id="nativeconfig"><a href="#nativeconfig" class="header-anchor">#</a> nativeConfig</h3> <p><code>{cssLangs: string[]}</code></p> <p>为原生多文件写法添加css预处理语言支持，用于优先搜索预编译器后缀的文件，按 cssLangs 中的声明顺序查找。默认按照 css , less , stylus ,  scss , sass 的顺序</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">nativeConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">cssLangs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'less'</span><span class="token punctuation">,</span> <span class="token string">'stylus'</span><span class="token punctuation">,</span> <span class="token string">'scss'</span><span class="token punctuation">,</span> <span class="token string">'sass'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="webconfig"><a href="#webconfig" class="header-anchor">#</a> webConfig</h3> <p><code>{transRpxFn(match:string, $1:number): string}</code></p> <p>transRpxFn 配置用于自定义输出 web 时对于 rpx 样式单位的转换逻辑，常见的方式有转换为 vw 或转换为 rem</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">webConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token function-variable function">transRpxFn</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> $1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>$1 <span class="token operator">===</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> $1
            <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$1 <span class="token operator">*</span> <span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">/</span> <span class="token number">750</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">vw</span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="i18n"><a href="#i18n" class="header-anchor">#</a> i18n</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">i18n</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">locale</span><span class="token operator">:</span> <span class="token string">'en-US'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string-property property">'en-US'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'{msg} world'</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">'zh-CN'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'{msg} 世界'</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// messagesPath: path.resolve(__dirname, '../src/i18n.js')</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Mpx 支持国际化，底层实现依赖类<code>wxs</code>能力，通过指定语言标识和语言包，可实现多语言之间的动态切换。可配置项包括locale、messages、messagesPath。</p> <h4 id="i18n-locale"><a href="#i18n-locale" class="header-anchor">#</a> i18n.locale</h4> <p><code>string</code></p> <p>通过配置 locale 属性，可指定语言标识，默认值为 'zh-CN'</p> <h4 id="i18n-messages"><a href="#i18n-messages" class="header-anchor">#</a> i18n.messages</h4> <p><code>object</code></p> <p>通过配置 messages 属性，可以指定项目语言包，Mpx 会依据语言包对象定义进行转换，示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">messages</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'en-US'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'title'</span><span class="token operator">:</span> <span class="token string">'DiDi Chuxing'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'subTitle'</span><span class="token operator">:</span> <span class="token string">'Make travel better'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">'zh-CN'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'title'</span><span class="token operator">:</span> <span class="token string">'滴滴出行'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'subTitle'</span><span class="token operator">:</span> <span class="token string">'让出行更美好'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="i18n-messagespath"><a href="#i18n-messagespath" class="header-anchor">#</a> i18n.messagesPath</h4> <p><code>string</code></p> <p>为便于开发，Mpx 还支持配置语言包资源路径 messagesPath 来代替 messages 属性，Mpx 会从该路径下的 js 文件导出语言包对象。如果同时配置 messages 和 messagesPath 属性，Mpx 会优先设定 messages 为 i18n 语言包资源。</p> <p>详细介绍及使用见<a href="/guide/tool/i18n.html">工具-国际化i18n</a>一节。</p> <h3 id="auditresource"><a href="#auditresource" class="header-anchor">#</a> auditResource</h3> <p><code>'component' | boolean = false</code></p> <p>检查资源输出情况，如果置为true，则会提示有哪些资源被同时输出到了多个分包，可以检查是否应该放进主包以消减体积，设置为 <code>'component'</code> 的话，则只检查组件资源是否被输出到多个分包。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">auditResource</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="subpackagemodulesrules"><a href="#subpackagemodulesrules" class="header-anchor">#</a> subpackageModulesRules</h3> <p><code>object</code></p> <p>是否将多分包共用的模块分别输出到各自分包中，匹配规则为include匹配到且未被exclude匹配到的资源</p> <p>依据微信小程序的分包策略，多个分包使用到的 js 模块会打入主包当中，但在大型分包较多的项目中，该策略极易将大量的模块打入主包，从而使主包体积大小超出2M限制，该配置项提供给开发者自主抉择，可将部分模块冗余输出至多个分包，从而控制主包体积不超限</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">subpackageModulesRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@someNpm/name/src/api/*.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@someNpm/name/src/api/module.js'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>tips: 该功能是将模块分别放入多个分包，模块状态不可复用，使用前要依据模块功能做好评估，例如全局store就不适用该功能</p></blockquote> <h3 id="generatebuildmap"><a href="#generatebuildmap" class="header-anchor">#</a> generateBuildMap</h3> <p><code>boolean = false</code></p> <p>是否生成构建结果与源码之间的映射文件。用于单元测试等场景。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">generateBuildMap</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>参考</strong>：<a href="/guide/tool/unit-test.html">单元测试</a></p> <h3 id="autovirtualhostrules"><a href="#autovirtualhostrules" class="header-anchor">#</a> autoVirtualHostRules</h3> <p><a href="#rules"><code>Rules</code></a>
批量配置是否虚拟化组件节点，对应微信中<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html" target="_blank" rel="noopener noreferrer"><code>VirtualHost</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。默认不开启，开启后也将抹平支付宝小程序中的表现差异。提供 include 和 exclude 以精确控制对哪些文件开启VirtualHost，哪些不开启。和webpack的rules规则相同。</p> <p>默认情况下，自定义组件本身的那个节点是一个“普通”的节点，使用时可以在这个节点上设置 <code>class</code> 、<code>style</code> 、动画、 flex 布局等，就如同普通的 view 组件节点一样。但有些时候，自定义组件并不希望这个节点本身可以设置样式、响应 flex 布局等，而是希望自定义组件内部的第一层节点能够响应 flex 布局或者样式由自定义组件本身完全决定。这种情况下，可以将这个自定义组件设置为“虚拟的”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">autoVirtualHostRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'../components/other'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注意：</strong> 建议使用<code>autoVirtualHostRules</code>配置项，不要使用微信组件内部的 options virtualHost 配置，因为组件内部的 options virtualHost 在跨平台输出时无法进行兼容抹平处理。</p> <h3 id="partialcompilerules"><a href="#partialcompilerules" class="header-anchor">#</a> partialCompileRules</h3> <p><code>{ include: string | RegExp | Function | Array&lt;string | RegExp | Function&gt; }</code></p> <p>在大型的小程序开发当中，全量打包页面耗时非常长，往往在<code>开发过程</code>中仅仅只需用到几个 pages 而已，该配置项支持打包指定的小程序页面。</p> <p><strong>注意：</strong> @mpxjs/webpack-plugin@2.9.41版本之前该配置为 partialCompile。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// include 可以是正则、字符串、函数、数组</span>
        <span class="token literal-property property">partialCompileRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token string">'/project/pages'</span><span class="token punctuation">,</span> <span class="token comment">// 文件路径包含 '/project/pages' 的页面都会被打包</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">pages\/internal</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 文件路径能与正则匹配上的页面都会被打包</span>
          <span class="token function">include</span> <span class="token punctuation">(</span><span class="token parameter">pageResourcePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// pageResourcePath 是小程序页面所在系统的文件路径</span>
            <span class="token keyword">return</span> pageResourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'pages'</span><span class="token punctuation">)</span> <span class="token comment">// 文件路径包含 'pages' 的页面都会被打包</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'/project/pages'</span><span class="token punctuation">,</span>
            <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">pages\/internal</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token parameter">pageResourcePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pageResourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'pages'</span><span class="token punctuation">)</span>
          <span class="token punctuation">]</span> <span class="token comment">// 满足任意条件的页面都会被打包</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>该特性只能用于<strong>开发环境</strong>，默认情况下会阻止所有页面(<strong>入口 app.mpx 除外</strong>)的打包。</p></div> <h3 id="optimizerenderrules"><a href="#optimizerenderrules" class="header-anchor">#</a> optimizeRenderRules</h3> <p><a href="#rules"><code>Rules</code></a></p> <p>render 函数中可能会存在一些重复变量，该配置可消除 render 函数中的重复变量，进而减少包体积。不配置该参数，则不会消除重复变量。</p> <p>同时框架 render 函数优化提供了两个等级，使用 level 字段来进行控制，默认为 level = 1</p> <ul><li>level = 1时，框架生成 render 函数中完成保留 template 中的计算逻辑，setData 传输量保持了最优。</li> <li>level = 2时，框架生成 render 函数中仅保留所有 template 中使用到的响应性变量，无任何计算逻辑保留，render 函数体积达最小状态，但 setData 传输量相对于 level=1 会有所增加。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">optimizeRenderRules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">level</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="asyncsubpackagerules"><a href="#asyncsubpackagerules" class="header-anchor">#</a> asyncSubpackageRules</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Condition</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">Function</span> <span class="token operator">|</span> RegExp

<span class="token keyword">interface</span> <span class="token class-name">AsyncSubpackageRules</span> <span class="token punctuation">{</span>
  include<span class="token operator">:</span> Condition <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Condition<span class="token operator">&gt;</span>
  exclude<span class="token operator">?</span><span class="token operator">:</span> Condition <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>Condition<span class="token operator">&gt;</span>
  root<span class="token operator">:</span> <span class="token builtin">string</span>
  placeholder<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> resource<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>include: 同 webpack include 规则</li> <li>exclude: 同 webpack exclude 规则</li> <li>root: 匹配规则的组件或js模块的输出分包名</li> <li>placeholder: 匹配规则的组件所配置的componentPlaceholder，可支持配置原生组件和自定义组件，原生组件可直接以string类型配置，自定义组件需要配置对象，name 为该自定义组件名, resource 为自定义组件的路径，路径可为绝对路径和相对于项目目录的相对路径</li></ul> <p>异步分包场景下批量设置组件或 js 模块的异步分包，提升资源异步分包输出的灵活性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// include 可以是正则、字符串、函数、数组</span>
        <span class="token literal-property property">asyncSubpackageRules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token string">'/project/pages'</span><span class="token punctuation">,</span> <span class="token comment">// 文件路径包含 '/project/pages' 的组件或者 require.async 异步引用的js 模块都会被打包至sub1分包</span>
            <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'sub1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'view'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li>该配置匹配的组件，若使用方在引用路径已设置?root或componentPlaceholder，则以引用路径中的?root或componentPlaceholder为最高优先级</li> <li>若placeholder配置使用自定义组件，注意一定要配置 placeholder 中的 resource 字段</li> <li>本功能只会对使用require.async异步引用的js模块生效，若引用路径中已配置?root，则以路径中?root优先</li></ul></div> <h3 id="retryrequireasync"><a href="#retryrequireasync" class="header-anchor">#</a> retryRequireAsync</h3> <p><code>boolean = false</code></p> <p>开启时在处理<code>require.async</code>时会添加单次重试逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">retryRequireAsync</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="disablerequireasync"><a href="#disablerequireasync" class="header-anchor">#</a> disableRequireAsync</h3> <p><code>boolean = false</code></p> <p>Mpx 框架在输出 微信小程序、支付宝小程序、字节小程序、Web 平台时，默认支持分包异步化能力，但若在某些场景下需要关闭该能力，可配置该项。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">disableRequireAsync</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="optimizesize"><a href="#optimizesize" class="header-anchor">#</a> optimizeSize</h3> <p><code>boolean = false</code></p> <p>开启后可优化编译配置减少构建产物体积</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">optimizeSize</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="mpxwebpackplugin-static-methods"><a href="#mpxwebpackplugin-static-methods" class="header-anchor">#</a> MpxWebpackPlugin static methods</h2> <p><code>MpxWebpackPlugin</code> 通过静态方法暴露了以下五个内置 loader，详情如下：</p> <h3 id="mpxwebpackplugin-loader"><a href="#mpxwebpackplugin-loader" class="header-anchor">#</a> MpxWebpackPlugin.loader</h3> <p><code>MpxWebpackPlugin</code> 所提供的最主要 loader，用于处理 <code>.mpx</code> 文件，根据不同的<a href="#mode">目标平台</a>将 <code>.mpx</code> 文件输出为不同的结果。</p> <blockquote><p>在微信环境下 <code>todo.mpx</code> 被loader处理后的文件为：<code>todo.wxml</code>、<code>todo.wxss</code>、<code>todo.js</code>、<code>todo.json</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.mpx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mpxwebpackplugin-pluginloader"><a href="#mpxwebpackplugin-pluginloader" class="header-anchor">#</a> MpxWebpackPlugin.pluginLoader</h3> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>该 loader 仅在开发<strong>小程序插件</strong>时使用，可在使用 Mpx 脚手架进行项目初始化时选择进行组件开发来生成对应的配置文件。</p></div> <p><code>MpxWebpackPlugin.pluginLoader</code> 用于根据开发者编写的<code>plugin.json</code>文件内容，将特定的小程序组件、页面以及 js 文件进行构建，最终以小程序插件的形式输出。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">resource</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src/plugin/plugin.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 小程序插件的plugin.json的绝对路径</span>
            <span class="token literal-property property">use</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">pluginLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>更多细节请查阅 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/development.html" target="_blank" rel="noopener noreferrer">小程序插件开发<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="mpxwebpackplugin-wxspreloader"><a href="#mpxwebpackplugin-wxspreloader" class="header-anchor">#</a> MpxWebpackPlugin.wxsPreLoader</h3> <p>加载并解析 <code>wxs</code> 脚本文件，并针对不同平台，做了差异化处理；同时可支持处理内联<code>wxs</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(wxs|qs|sjs|filter\.js)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">wxsPreLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'pre'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mpxwebpackplugin-fileloader"><a href="#mpxwebpackplugin-fileloader" class="header-anchor">#</a> MpxWebpackPlugin.fileLoader</h3> <p>提供图像资源的处理，生成对应图像文件，输出到输出目录并返回 public URL。如果是分包资源，则会输出到相应的分包资源文件目录中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">fileLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>选项</strong>：</p> <ul><li><code>name</code> : 自定义输出文件名模板</li></ul> <h3 id="mpxwebpackplugin-urlloader"><a href="#mpxwebpackplugin-urlloader" class="header-anchor">#</a> MpxWebpackPlugin.urlLoader</h3> <p>微信小程序对于图像资源存在一些限制，<code>MpxWebpackPlugin.urlLoader</code> 针对这些差异做了相关处理，开发者可以使用web应用开发的方式进行图像资源的引入，<code>MpxWebpackPlugin.urlLoader</code> 可根据图像资源的不同引入方式，支持 CDN 或者 Base64 的方式进行处理。更多细节请查阅<a href="/guide/advance/image-process.html">图像资源处理</a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpe?g|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">urlLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">2048</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>选项</strong>:</p> <ul><li><code>name</code> :  自定义输出文件名模板</li> <li><code>mimetype</code> : 指定文件的 MIME 类型</li> <li><code>limit</code> : 对内联文件作为数据 URL 的字节数限制</li> <li><code>publicPath</code> : 自定义 public 目录</li> <li><code>fallback</code> : 文件字节数大于限制时，为文件指定加载程序</li></ul> <h3 id="mpxwebpackplugin-getpageentry"><a href="#mpxwebpackplugin-getpageentry" class="header-anchor">#</a> MpxWebpackPlugin.getPageEntry</h3> <p>在 webpack config entry 入口文件配置中，你可以使用该方法获取独立构建页面路径，构建产物为该页面的独立原生代码，
你可以提供该页面给其他小程序使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">getPageEntry</span><span class="token punctuation">(</span><span class="token string">'./index.mpx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mpxwebpackplugin-getcomponententry"><a href="#mpxwebpackplugin-getcomponententry" class="header-anchor">#</a> MpxWebpackPlugin.getComponentEntry</h3> <p>在 webpack config entry 入口文件配置中，你可以使用该方法获取独立构建组件路径，构建产物为该组件的独立原生代码，
你可以提供该组件给其他小程序使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">getComponentEntry</span><span class="token punctuation">(</span><span class="token string">'./components/list.mpx'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mpxwebpackplugin-getnativeentry"><a href="#mpxwebpackplugin-getnativeentry" class="header-anchor">#</a> MpxWebpackPlugin.getNativeEntry</h3> <p>在 webpack config entry 入口文件配置中，你可以使用该方法获取原生小程序入口文件路径。如果你不想将原生的小程序入口文件整合为 <code>app.mpx</code> 文件，则可以使用该方法直接使用原有的小程序入口文件进行编译。见<a href="%5B1330%5D(https://github.com/didi/mpx/issues/1330)">#1330</a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将 app 入口由默认的 app.mpx 更改为 app.js</span>
    config<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MpxWebpackPlugin<span class="token punctuation">.</span><span class="token function">getNativeEntry</span><span class="token punctuation">(</span><span class="token string">'./src/app.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="mpxunocssplugin"><a href="#mpxunocssplugin" class="header-anchor">#</a> MpxUnocssPlugin</h2> <p>Mpx 编译 unocss 原子类的 webpack 主插件</p> <p>如果在使用 <code>@mpxjs/cli@3.x</code> 创建项目时选择了 unocss，会自动安装 MpxUnocssPlugin ，直接在 mpx.unocss 配置项中传入相关配置即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// @mpxjs/unocss-plugin 相关的配置</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如果创建项目时未选 unocss，需手动安装，安装示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @mpxjs/unocss-plugin
<span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @mpxjs/unocss-plugin
<span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> @mpxjs/unocss-plugin
</code></pre></div><p>使用示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// vue.config.js</span>
  <span class="token keyword">const</span> MpxUnocssPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/unocss-plugin'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">configureWebpack</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MpxUnocssPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token comment">// @mpxjs/unocss-plugin 相关的配置</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>插件支持配置如下：</p> <h3 id="unofile"><a href="#unofile" class="header-anchor">#</a> unoFile</h3> <p><code>string = 'styles/uno'</code></p> <p>生成主包或分包通用样式存储的相对路径</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">unoFile</span><span class="token operator">:</span> <span class="token string">'styles/uno'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>则会把通用样式存储到下面目录</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 主包</span>
  dist<span class="token operator">/</span>wx<span class="token operator">/</span>styles<span class="token operator">/</span>uno<span class="token punctuation">.</span>wxss
  <span class="token comment">// 分包</span>
  dist<span class="token operator">/</span>wx<span class="token operator">/</span><span class="token keyword">package</span><span class="token operator">/</span>styles<span class="token operator">/</span>uno<span class="token punctuation">.</span>wxss
</code></pre></div><h3 id="mincount"><a href="#mincount" class="header-anchor">#</a> minCount</h3> <p><code>number = 2</code></p> <p>使用到某个原子类的最小分包个数，比如设置为2的话一个原子类只有超过2个分包使用才会输出到主包</p> <blockquote><p>主要是用来控制主包占用的，数值越大分包的原子类就有更大可能性不占用主包</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">minCount</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>  <span class="token comment">&lt;!-- minCount=2 --&gt;</span>
  <span class="token comment">&lt;!-- a分包 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-black color-white<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- b分包 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-black<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>unocss将把生成的<code>bg-black</code>样式打包到主包</p> <h3 id="styleisolation"><a href="#styleisolation" class="header-anchor">#</a> styleIsolation</h3> <p><code>string = 'isolated'</code></p> <p>需要和微信小程序的styleIsolation配合使用，比如小程序使用样式隔离的话，这里需要对应配置为isolated，这样的话每个组件会独立引用对应的原子类文件，配置为'apply-shared'的话只有父级页面和app会建立引用，然后通过配合微信的apply-shared的方式获取父级上定义的原子类</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">styleIsolation</span><span class="token operator">:</span> <span class="token string">'isolated'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="scan"><a href="#scan" class="header-anchor">#</a> scan</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">interface</span> <span class="token class-name">Scan</span> <span class="token punctuation">{</span>
    include<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    exclude<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>配置需要扫描的文件目录</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">scan</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">include</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src/**/*'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="escapemap"><a href="#escapemap" class="header-anchor">#</a> escapeMap</h3> <p><code>object</code></p> <p>针对原子类中出现的<code>[</code> <code>(</code> <code>,</code>等特殊字符，在web中会通过转义字符<code>\</code>进行转义，由于小程序环境下不支持css选择器中出现<code>\</code>转义字符，我们内置支持了一套不带<code>\</code>的转义规则对这些特殊字符进行转义，同时替换模版和css文件中的类名，内建的默认转义规则，可自定义转译规则</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">escapeMap</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">':'</span><span class="token operator">:</span> <span class="token string">'_d_'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code>  &lt;view class=<span class="token string">&quot;dark:text-green-400&quot;</span>/&gt;
</code></pre></div><p>将会转化为</p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.dark .dark_d_text-green-400</span><span class="token punctuation">{</span><span class="token property">--un-text-opacity</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>74<span class="token punctuation">,</span>222<span class="token punctuation">,</span>128<span class="token punctuation">,</span><span class="token function">var</span><span class="token punctuation">(</span>--un-text-opacity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="root"><a href="#root" class="header-anchor">#</a> root</h3> <p><code>string = process.cwd()</code></p> <p>文件根目录</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">root</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="transformcss"><a href="#transformcss" class="header-anchor">#</a> transformCSS</h3> <p><code>boolean = true</code></p> <p>转化css指令为常规css</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transformCSS</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.custom-div</span> <span class="token punctuation">{</span>
    <span class="token atrule"><span class="token rule">@apply</span> text-center my-0 font-medium<span class="token punctuation">;</span></span>
  <span class="token punctuation">}</span>
</code></pre></div><p>将会转化为</p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.custom-div</span> <span class="token punctuation">{</span>
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">font-weight</span><span class="token punctuation">:</span> 500<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="transformgroups"><a href="#transformgroups" class="header-anchor">#</a> transformGroups</h3> <p><code>boolean = true</code></p> <p>转化Variant group</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">transformGroups</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lg:(p-2 m-2 text-red-600)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>将会转化为</p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lg:p-2 lg:m-2 lg:text-red-600<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="config"><a href="#config" class="header-anchor">#</a> config</h3> <p><code>UserConfig | string</code></p> <p>config可以传配置对象也可以传一个配置文件路径</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'m-1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">'10rpx'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="configfiles"><a href="#configfiles" class="header-anchor">#</a> configFiles</h3> <p><code>LoadConfigSource[]</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">interface</span> <span class="token class-name">LoadConfigSource<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
      files<span class="token operator">:</span> Arrayable<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token comment">/**
       * @default ['mts', 'cts', 'ts', 'mjs', 'cjs', 'js', 'json', '']
      */</span>
      extensions<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">/**
       * Loader for loading config,
      *
      * @default 'auto'
      */</span>
      parser<span class="token operator">?</span><span class="token operator">:</span> BuiltinParsers <span class="token operator">|</span> CustomParser<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token string">'auto'</span><span class="token punctuation">;</span>
      <span class="token comment">/**
       * Rewrite the config object,
      * return nullish value to bypassing loading the file
      */</span>
      rewrite<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">F</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">F</span><span class="token punctuation">,</span> filepath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token comment">/**
       * Transform the source code before loading,
      * return nullish value to skip transformation
      */</span>
      transform<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> filepath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
      <span class="token comment">/**
       * Skip this source if error occurred on loading
      *
      * @default false
      */</span>
      skipOnError<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>configFiles的话是传递额外的配置文件数组，比如不想用uno.config作为配置文件的话可以在这里面配</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">unocss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">configFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'uno2.config.js'</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="commentconfig"><a href="#commentconfig" class="header-anchor">#</a> commentConfig</h3> <p>我们还支持了commentConfig进行组件局部配置，目前支持safelist和styleIsolation，safelist可以用空格分隔写多个</p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- mpx_config_styleIsolation: 'isolated' --&gt;</span>
    <span class="token comment">&lt;!-- mpx_config_safelist: 'text-red-500 bg-black' --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>mpx-unocss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="mpxunocssbase"><a href="#mpxunocssbase" class="header-anchor">#</a> MpxUnocssBase</h2> <p>Mpx 内置的 unocss preset，继承自 <code>@unocss/preset-uno</code>，并额外提供小程序原子类的预设样式，安装示例如下：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @mpxjs/unocss-base
<span class="token function">pnpm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> @mpxjs/unocss-base
<span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> @mpxjs/unocss-base
</code></pre></div><p>使用示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// uno.config.js</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'unocss'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> presetMpx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/unocss-base'</span><span class="token punctuation">)</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">presetMpx</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// unocss的config，具体配置参考https://unocss.dev/config/</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>支持的配置项如下：</p> <h3 id="basefontsize"><a href="#basefontsize" class="header-anchor">#</a> baseFontSize</h3> <p><code>number = 37.5</code></p> <p>同比换算1rem = 37.5rpx适配小程序</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// uno.config.js</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'unocss'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> presetMpx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/unocss-base'</span><span class="token punctuation">)</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">presetMpx</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">baseFontSize</span><span class="token operator">:</span> <span class="token number">37.5</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="preflight"><a href="#preflight" class="header-anchor">#</a> preflight</h3> <p><code>boolean = true</code></p> <p>是否生成预设样式</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// uno.config.js</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'unocss'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> presetMpx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/unocss-base'</span><span class="token punctuation">)</span>

  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">presetMpx</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">preflight</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>将添加预设样式在主包</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">page</span><span class="token punctuation">{</span><span class="token property">--un-rotate</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-rotate-x</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-rotate-y</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-rotate-z</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-scale-x</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">--un-scale-y</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">--un-scale-z</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">--un-skew-x</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-skew-y</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-translate-x</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-translate-y</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-translate-z</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-pan-x</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-pan-y</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-pinch-zoom</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-scroll-snap-strictness</span><span class="token punctuation">:</span>proximity<span class="token punctuation">;</span><span class="token property">--un-ordinal</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-slashed-zero</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-numeric-figure</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-numeric-spacing</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-numeric-fraction</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-border-spacing-x</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-border-spacing-y</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span><span class="token property">--un-ring-offset-shadow</span><span class="token punctuation">:</span>0 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">--un-ring-shadow</span><span class="token punctuation">:</span>0 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">--un-shadow-inset</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-shadow</span><span class="token punctuation">:</span>0 0 <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">,</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">--un-ring-inset</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-ring-offset-width</span><span class="token punctuation">:</span>0px<span class="token punctuation">;</span><span class="token property">--un-ring-offset-color</span><span class="token punctuation">:</span>#fff<span class="token punctuation">;</span><span class="token property">--un-ring-width</span><span class="token punctuation">:</span>0px<span class="token punctuation">;</span><span class="token property">--un-ring-color</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>147<span class="token punctuation">,</span>197<span class="token punctuation">,</span>253<span class="token punctuation">,</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token property">--un-blur</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-brightness</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-contrast</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-drop-shadow</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-grayscale</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-hue-rotate</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-invert</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-saturate</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-sepia</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-blur</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-brightness</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-contrast</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-grayscale</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-hue-rotate</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-invert</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-opacity</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-saturate</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token property">--un-backdrop-sepia</span><span class="token punctuation">:</span> <span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="dark"><a href="#dark" class="header-anchor">#</a> dark</h3> <p><code>class | media | DarkModeSelectors = 'class'</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">interface</span> <span class="token class-name">DarkModeSelectors</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * light variant的选择器.
     *
     * @default '.light'
     */</span>
    light<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>

    <span class="token comment">/**
     * dark variant的选择器
     *
     * @default '.dark'
     */</span>
    dark<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，此预设使用dark:variant生成基于类的dark模式。</p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dark:text-green-400<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>我们将生成</p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.dark .dark_c_text-green-400</span><span class="token punctuation">{</span><span class="token property">--un-text-opacity</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>74<span class="token punctuation">,</span>222<span class="token punctuation">,</span>128<span class="token punctuation">,</span><span class="token function">var</span><span class="token punctuation">(</span>--un-text-opacity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><p>要选择基于媒体查询的dark模式，您可以使用@dark:variant</p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@dark:text-green-400<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>我们将生成</p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span><span class="token punctuation">{</span>
    <span class="token selector">._u_dark_c_text-green-400</span><span class="token punctuation">{</span><span class="token property">--un-text-opacity</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>74<span class="token punctuation">,</span>222<span class="token punctuation">,</span>128<span class="token punctuation">,</span><span class="token function">var</span><span class="token punctuation">(</span>--un-text-opacity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>或者使用针对dark:variant的配置进行全局设置</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">presetMpx</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">dark</span><span class="token operator">:</span> <span class="token string">&quot;media&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="attributifypseudo"><a href="#attributifypseudo" class="header-anchor">#</a> attributifyPseudo</h3> <p><code>boolean = false</code></p> <p>将伪选择器生成为[group='']，而不是.group。只支持<code>group</code>|<code>peer</code>|<code>parent</code>|<code>previous</code>
如果attributifyPseudo为true的话，</p> <div class="language-html extra-class"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>group-hover:opacity-100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面template将生成</p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">[group=&quot;&quot;]:hover .group-hover_c_opacity-100</span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><p>为false则生成</p> <div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.group:hover .group-hover_c_opacity-100</span><span class="token punctuation">{</span><span class="token property">opacity</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="variableprefix"><a href="#variableprefix" class="header-anchor">#</a> variablePrefix</h3> <p><code>string = 'un-'</code></p> <p>CSS变量的前缀</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">presetMpx</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">variablePrefix</span><span class="token operator">:</span> <span class="token string">'un-'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code>  <span class="token selector">.bg-red-500</span><span class="token punctuation">{</span><span class="token property">--un-bg-opacity</span><span class="token punctuation">:</span>1<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span>68<span class="token punctuation">,</span>68<span class="token punctuation">,</span><span class="token function">var</span><span class="token punctuation">(</span>--un-bg-opacity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="request-query"><a href="#request-query" class="header-anchor">#</a> Request query</h2> <p>Mpx中允许用户在request中传递特定query执行特定逻辑，目前已支持的query如下：</p> <h3 id="resolve"><a href="#resolve" class="header-anchor">#</a> ?resolve</h3> <p>用于获取资源最终被输出的正确路径。</p> <p>Mpx 在处理页面路径时会把对应的分包名作为 root 加在路径前。处理组件路径时会添加 hash，防止路径名冲突。直接写资源相对路径可能与最终输出的资源路径不符。</p> <p>编写代码时使用 import 引入页面地址后加上 <code>?resolve</code>，这个地址在编译时会被处理成正确的绝对路径，即资源的最终输出位置。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> subPackageIndexPage <span class="token keyword">from</span> <span class="token string">'../subpackage/pages/index.mpx?resolve'</span>

mpx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> subPackageIndexPage
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="root"><a href="#root" class="header-anchor">#</a> ?root</h3> <ol><li>声明分包别名</li></ol> <p>指定分包别名，Mpx 项目在编译构建后会输出该别名的分包，外部小程序或 H5 页面跳转时，可直接配置该分包别名下的资源路径。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 可在项目app.mpx中进行配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">packages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'@packagePath/src/app.mpx?root=test'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">url</span> <span class="token operator">:</span> <span class="token string">'/test/homepage/index'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>声明组件所属异步分包</li></ol> <p>微信小程序新增 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/async.html" target="_blank" rel="noopener noreferrer">分包异步化特性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，使跨分包的组件可以等待对应分包下载后异步使用, 在mpx中使用需通过?root声明组件所属异步分包即可使用，示例如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--/packageA/pages/index.mpx--&gt;</span>
// 这里在分包packageA中即可异步使用分包packageB中的hello组件
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../../packageB/components/hello?root=packageB&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;simple-hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;../components/hello&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;componentPlaceholder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;hello&quot;</span><span class="token operator">:</span> <span class="token string">&quot;simple-hello&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="fallback"><a href="#fallback" class="header-anchor">#</a> ?fallback</h3> <p><code>boolean</code></p> <p>对于使用<code>MpxWebpackPlugin.urlLoader</code>的文件，如果在引用资源的末尾加上<code>?fallback=true</code>，则使用配置的自定义loader。图片的引入和处理详见<a href="/guide/advance/image-process.html">图像资源处理</a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">pluginOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">mpx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">urlLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'img/[name][hash].[ext]'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">'http://a.com/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fallback</span><span class="token operator">:</span> <span class="token string">'file-loader'</span> <span class="token comment">// 自定义fallback为true时使用的loader</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* png资源引入 */</span>
<span class="token selector">&lt;style&gt;
  .logo2</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'./images/logo.png?fallback=true'</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token comment">/* 设置fallback=true，则使用如上方所配置的file-loader */</span>
  <span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre></div><h3 id="uselocal"><a href="#uselocal" class="header-anchor">#</a> ?useLocal</h3> <p><code>boolean</code></p> <p>静态资源存放有两种方式：本地、远程（配置 publicPath ）。useLocal 是用于在配置了 publicPath 时声明部分资源输出到本地。比如配置了通用的 CDN 策略，但如网络兜底资源需要强制走本地存储，可在引用资源的末尾加上<code>?useLocal=true</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token comment">/* 单个图片资源设置为存储到本地 */</span>
<span class="token selector">&lt;style&gt;
  .logo2</span> <span class="token punctuation">{</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">'./images/logo.png?useLocal=true'</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre></div><h3 id="isstyle"><a href="#isstyle" class="header-anchor">#</a> ?isStyle</h3> <p><code>boolean</code></p> <p>isStyle 是在非 style 模块中编写样式时，声明这部分引用的静态资源按照 style 环境来处理。如在 javascript 中 require 了一个图像资源，然后模版 template style 属性中进行引用， 则 require 资源时可选择配置<code>?isStyle=true</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- isStyle 案例一：引用 javascript 中的数据 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span>testStyle<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- isStyle 案例二：设置资源按照style处理规则处理。style处理规则为: 默认走base64，除非同时配置了 publicPath 和 fallback --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../images/car.jpg?isStyle=true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 普通非style模式，默认走 fallback 或者 file-loader 解析，输出到 publicPath 或者 本地img目录下 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../images/car.jpg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 将 script 中的图像资源标识为 style 资源 */</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> createComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@mpxjs/core'</span>
  <span class="token keyword">const</span> backCar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../images/car.jpg?isStyle=true'</span><span class="token punctuation">)</span>

  <span class="token function">createComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">testStyle</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">background-image : url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>backCar<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">); width:100px; height: 100px</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h3 id="ispage"><a href="#ispage" class="header-anchor">#</a> ?isPage</h3> <p><code>boolean</code></p> <p>在 webpack config entry 入口文件配置中，你可以在路径后追加 ?isPage 来声明独立页面构建，构建产物为该页面的独立原生代码，
你可以提供该页面给其他小程序使用。此外，独立页面构建也可以通过MpxWebpackPlugin.getPageEntry生成，推荐使用<a href="#mpxwebpackplugin-getpageentry">此方法。</a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'../src/pages/index.mpx?isPage'</span><span class="token punctuation">)</span>
    <span class="token comment">// 或者</span>
    <span class="token comment">// config.entry('index').add(MpxWebpackPlugin.getPageEntry('./index.mpx'))</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>对于使用 <code>@mpxjs/cli@2.x</code> 脚手架初始化的项目，配置 entry 的方式如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// build/getWebpackConf.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">'../src/pages/index.mpx?isPage'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="iscomponent"><a href="#iscomponent" class="header-anchor">#</a> ?isComponent</h3> <p><code>boolean</code></p> <p>在 webpack config entry 入口文件配置中，你可以在路径后追加 ?isComponent 来声明独立组件构建，构建产物为该组件的独立原生代码，
你可以提供该组件给其他小程序使用。
此外，独立组件构建也可以通过MpxWebpackPlugin.getComponentEntry生成，推荐使用<a href="#mpxwebpackplugin-getcomponententry">此方法。</a>。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vue.config.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@vue/cli-service'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MpxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@mpxjs/webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'../src/components/list.mpx?isComponent'</span><span class="token punctuation">)</span>
    <span class="token comment">// 或者</span>
    <span class="token comment">// config.entry('index').add(MpxWebpackPlugin.getComponentEntry('./components/list.mpx'))</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="async"><a href="#async" class="header-anchor">#</a> ?async</h3> <p><code>boolean | string</code></p> <p>输出 H5 时 Vue Router 的路由懒加载功能，Mpx框架默认会对分包开启路由懒加载功能并将分包所有页面都打入同一个Chunk
，如果你希望对于部分主包页面或者分包页面配置路由懒加载并想自定义Chunk Name，则可以使用该功能。</p> <div class="language-html extra-class"><pre class="language-html"><code>// app.mpx 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./pages/index?async&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 主包页面配置路由懒加载，Chunk Name 为随机数字</span>
      <span class="token string">&quot;./pages/index2?async=app_pages2&quot;</span>，<span class="token comment">// 主包页面配置路由懒加载，Chunk Name 自定义为 app_pages2</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./packages/sub1/app.mpx?root=sub1&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

// packages/sub1/app.mpx

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>application/json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;./pages/index?async=sub1_pages_index&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包中页面设置路由懒加载并设置自定义Chunk Name</span>
      <span class="token string">&quot;./pages/index2?async=sub2_pages_index2&quot;</span> <span class="token comment">// 分包中页面设置路由懒加载并设置自定义Chunk Name</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api/directives.html" class="prev">
        模板指令
      </a></span> <span class="next"><a href="/api/builtIn.html">
        内建组件
      </a>
      →
    </span></p></div> </main></div></div></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.84c88b57.js" defer></script><script src="/assets/js/7.01e4e942.js" defer></script><script src="/assets/js/3.145e69cd.js" defer></script><script src="/assets/js/1.4f7abe8f.js" defer></script><script src="/assets/js/38.7826170e.js" defer></script><script src="/assets/js/30.04d1a7ea.js" defer></script>
  </body>
</html>
